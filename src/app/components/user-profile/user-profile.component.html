<div class="w-100 h-100 overflow-hidden d-flex flex-column border-left position-relative">
  <div class="user-profile-header d-flex align-items-center justify-content-start p-3">
    <span class="cursor-hand d-flex align-items-center mr-3" (click)="closeProfile.emit(false)">
      <svg class="cross-icon" id="Layer_1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24"
        height="24">
        <path d="M20 11H7.8l5.6-5.6L12 4l-8 8 8 8 1.4-1.4L7.8 13H20v-2z"></path>
      </svg>
    </span>
    <h3 class="TitilliumWeb-bold pl-3 mb-0 theme-font-color">Profile</h3>
  </div>
  <div class="profile-container flex-grow overflow-auto">
    <form [formGroup]="profileForm" role="form">
      <div class="profile d-flex p-4 flex-column justify-content-center align-items-center">
        <input type="file" #fileInput id="profileImage" name="upload" (change)="onFileSelect($event)"
          class="d-none-normal" accept="image/*" />
        <div class="position-relative profile-image-container" (mouseenter)="showImageLayer = true"
          (mouseleave)="showImageLayer = false">
          <img id="user-profile-image"
            [src]="profileInfo.user_image || profileInfo.user_image_url || '../../../assets/img/placeholder.png'"
            class="mr-2 position-absolute profile-image rounded-img-fugu">
          <div (click)="openPhotoOptions($event)" class="image-layer cursor-hand pl-2 pr-2 position-absolute d-flex
           flex-column align-items-center justify-content-center rounded-img-fugu" *ngIf="showImageLayer">
            <i class="fa fa-camera mb-2" style="pointer-events: none"></i>
            CHANGE PROFILE PHOTO
          </div>
          <div *ngIf="view_photo_options" class="photo-options-menu position-absolute" id="user-menu" click-outside
            (clickOutside)="profileOptionsClickOutside($event)">
            <button *ngIf="profileInfo.user_image || profileInfo.user_image_url"
              (click)="view_photo_options = false;viewEnlargedImage()" class="btn-custom-nostyle outline-none
             box-shadow-none w-100 p-2 pl-3 pr-3 cursor-hand chat-menu-option">
              View Photo
            </button>
            <button (click)="fileInput.click();view_photo_options = false" class="btn-custom-nostyle outline-none
            box-shadow-none w-100 p-2 pl-3 pr-3 cursor-hand chat-menu-option">
              Upload Photo
            </button>
            <button *ngIf="profileInfo.user_image || profileInfo.user_image_url"
              (click)="showDeleteConfirmationPopup = true" class="btn-custom-nostyle outline-none
            box-shadow-none w-100 p-2 pl-3 pr-3 cursor-hand chat-menu-option">
              Delete Photo
            </button>
          </div>
        </div>
      </div>
      <div class="contact-information pl-3 pr-3">
        <span class="contact-header font-weight-light mb-0">YOUR NAME</span>
        <div [ngClass]="{'input-border-bottom':edit}"
          class="font-input name-container d-flex flex-row justify-content-between align-items-center">
          <input id="name-input" type="text" class="mr-2 border-none outline-none w-100 theme-font-color input-bg"
            [ngClass]="{'form-read-only': !edit}" maxlength="25" [readonly]="!edit" formControlName="full_name">
          <span class="text-center font-weight-bold">
            <span class="float-right app-color">
              <span [hidden]="edit" class="right-position-icon"
                (click)="onInputNameClick()">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                  <g fill="none" fill-rule="evenodd">
                    <path d="M0 0h24v24H0z" />
                    <path fill="var(--chat-header-text)"
                      d="M18.923 3.006a3.05 3.05 0 0 0-2.175.895h-.006L5.173 15.668l-2.08 6.244 6.239-2.085.132-.126L21.099 8.252a3.087 3.087 0 0 0 0-4.35 3.076 3.076 0 0 0-2.176-.896zm0 1.532c.39 0 .781.145 1.088.451a1.527 1.527 0 0 1 0 2.176L18.797 8.36a3.874 3.874 0 0 0-.866-1.286 3.861 3.861 0 0 0-1.292-.866l1.202-1.226c.3-.294.691-.45 1.082-.445zm-3.3 2.97c.283.023.698.131 1.215.648.523.523.63.938.66 1.22.019.217-.011.247-.023.283l-7.951 7.818a3.933 3.933 0 0 0-.83-1.178 3.866 3.866 0 0 0-1.177-.823l7.824-7.945c.036-.018.066-.042.283-.024zM6.46 16.75c.24.018.625.114 1.154.643.523.523.619.907.637 1.142 0 .03-.006.012 0 .036l-1.466.487a4.326 4.326 0 0 0-.841-.835l.492-1.473c.018.006 0 0 .024 0z" />
                  </g>
                </svg>

              </span>
              <!-- <img src="assets/img/pencil.svg" [hidden]="edit" class="right-position-icon" (click)="onInputNameClick()"> -->
              <!-- <i class="fa fa-edit" [hidden]="edit" (click)="edit = true"></i> -->
              <button [hidden]="!edit" class="btn btn-bg-color pr-0 pb-0 box-shadow-none" (click)="saveProfile()">
                <svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18">
                  <path fill="var(--chat-header-text)" d="M8 17.1l-5.2-5.2-1.7 1.7 6.9 7L22.9 5.7 21.2 4 8 17.1z">
                  </path>
                </svg>
              </button>
              <!-- <button [hidden]="!edit" class="btn btn-common-small" (click)="saveProfile()">Save</button> -->
            </span>
          </span>
        </div>
      </div>
      <div class="contact-information mt-3 pl-3 pr-3">
        <div class="d-flex flex-row justify-content-between">
          <span class="contact-header font-weight-light mb-0">CONTACT INFORMATION</span>
          <span class="">
            <span class="float-right app-color">
              <!-- <img src="assets/img/pencil.svg" [hidden]="editLocation" class="right-position-icon" (click)="onInputLocationClick()"> -->
              <span [hidden]="editLocation" class="right-position-icon"
                (click)="onInputLocationClick()">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                  <g fill="none" fill-rule="evenodd">
                    <path d="M0 0h24v24H0z" />
                    <path fill="var(--chat-header-text)"
                      d="M18.923 3.006a3.05 3.05 0 0 0-2.175.895h-.006L5.173 15.668l-2.08 6.244 6.239-2.085.132-.126L21.099 8.252a3.087 3.087 0 0 0 0-4.35 3.076 3.076 0 0 0-2.176-.896zm0 1.532c.39 0 .781.145 1.088.451a1.527 1.527 0 0 1 0 2.176L18.797 8.36a3.874 3.874 0 0 0-.866-1.286 3.861 3.861 0 0 0-1.292-.866l1.202-1.226c.3-.294.691-.45 1.082-.445zm-3.3 2.97c.283.023.698.131 1.215.648.523.523.63.938.66 1.22.019.217-.011.247-.023.283l-7.951 7.818a3.933 3.933 0 0 0-.83-1.178 3.866 3.866 0 0 0-1.177-.823l7.824-7.945c.036-.018.066-.042.283-.024zM6.46 16.75c.24.018.625.114 1.154.643.523.523.619.907.637 1.142 0 .03-.006.012 0 .036l-1.466.487a4.326 4.326 0 0 0-.841-.835l.492-1.473c.018.006 0 0 .024 0z" />
                  </g>
                </svg>

              </span>
              <button [hidden]="!editLocation" class="btn btn-bg-color pr-0 box-shadow-none pb-0"
                (click)="saveProfile()">
                <svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18">
                  <path fill="var(--chat-header-text)" d="M8 17.1l-5.2-5.2-1.7 1.7 6.9 7L22.9 5.7 21.2 4 8 17.1z">
                  </path>
                </svg>
              </button>
            </span>
          </span>
        </div>
        <div class="row no-gutters align-items-center pb-1"
          *ngIf="profileInfo.email && !profileInfo.email.includes('@junglework.auth')">
          <span class="contact-info col-3">Email</span>
          <span class="col-9 theme-font-color font-size-name">{{profileInfo.email}}</span>
        </div>
        <div class="row no-gutters align-items-center">
          <span class="contact-info col-3">Phone</span>
          <div class="col-9 location-container" [ngClass]="{'input-border-bottom':editLocation}"
            (click)="phoneChangePopup = true">
            <div class="pt-1 pl-0 theme-font-color font-size-name">
              {{profileInfo.contact_number}}
            </div>
          </div>
        </div>
        <div class="row no-gutters align-items-center">
          <span class="contact-info col-3">Location </span>
          <div class="col-9 location-container" [ngClass]="{'input-border-bottom':editLocation}">
            <input id="input-location" type="text"
              class="border-none outline-none input-box p-1 w-100 theme-font-color input-bg"
              [title]="profileForm.value.location" [ngClass]="{'form-read-only': !editLocation}"
              [readonly]="!editLocation" formControlName="location">
          </div>
        </div>
      </div>
      <div class="contact-information mt-3 mb-2 pl-3 pr-2 pb-3 border-bottom-gray">
        <div class="d-flex flex-row justify-content-between">
          <span class="contact-header font-weight-light mb-0">HUMAN RESOURCES</span>
          <span class="">
            <span class="float-right app-color">
              <!-- <img src="assets/img/pencil.svg" [hidden]="editLocation" class="right-position-icon" (click)="onInputLocationClick()"> -->
              <span
                [hidden]="!((roleStatus == RoleStatusEnum.isOwner && !editHR) || (roleStatus == RoleStatusEnum.isAdmin && !editHR))"
                class="right-position-icon" (click)="onInputHRClick()">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                  <g fill="none" fill-rule="evenodd">
                    <path d="M0 0h24v24H0z" />
                    <path fill="var(--chat-header-text)"
                      d="M18.923 3.006a3.05 3.05 0 0 0-2.175.895h-.006L5.173 15.668l-2.08 6.244 6.239-2.085.132-.126L21.099 8.252a3.087 3.087 0 0 0 0-4.35 3.076 3.076 0 0 0-2.176-.896zm0 1.532c.39 0 .781.145 1.088.451a1.527 1.527 0 0 1 0 2.176L18.797 8.36a3.874 3.874 0 0 0-.866-1.286 3.861 3.861 0 0 0-1.292-.866l1.202-1.226c.3-.294.691-.45 1.082-.445zm-3.3 2.97c.283.023.698.131 1.215.648.523.523.63.938.66 1.22.019.217-.011.247-.023.283l-7.951 7.818a3.933 3.933 0 0 0-.83-1.178 3.866 3.866 0 0 0-1.177-.823l7.824-7.945c.036-.018.066-.042.283-.024zM6.46 16.75c.24.018.625.114 1.154.643.523.523.619.907.637 1.142 0 .03-.006.012 0 .036l-1.466.487a4.326 4.326 0 0 0-.841-.835l.492-1.473c.018.006 0 0 .024 0z" />
                  </g>
                </svg>

              </span>
              <button [hidden]="!editHR" class="btn btn-bg-color pr-0 box-shadow-none pb-0" (click)="saveProfile()">
                <svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18">
                  <path fill="var(--chat-header-text)" d="M8 17.1l-5.2-5.2-1.7 1.7 6.9 7L22.9 5.7 21.2 4 8 17.1z">
                  </path>
                </svg>
              </button>
            </span>
          </span>
        </div>
        <div class="row no-gutters align-items-center" *ngIf="profileInfo.designation">
          <span class="contact-info col-3">Designation</span>
          <div class="col-9 location-container" [ngClass]="{'input-border-bottom':editHR}">
            <input id="input-designation" type="text"
              class="border-none outline-none input-box p-1 w-100 theme-font-color input-bg"
              [title]="profileInfo.designation" [ngClass]="{'form-read-only': !editHR}" [readonly]="!editHR"
              formControlName="designation">
          </div>
        </div>
        <div class="row no-gutters align-items-center" *ngIf="profileInfo.department">
          <span class="contact-info col-3">Department</span>
          <div class="col-9 location-container" [ngClass]="{'input-border-bottom':editHR}">
            <input id="input-department" type="text"
              class="border-none outline-none input-box p-1 w-100 theme-font-color input-bg"
              [title]="profileInfo.department" [ngClass]="{'form-read-only': !editHR}" [readonly]="!editHR"
              formControlName="department">
          </div>
        </div>
        <div class="row no-gutters align-items-center" *ngIf="is_owner_admin || (managerData && managerData.full_name)">
          <span class="contact-info col-3">Manager</span>
          <div class="col-9 location-container pt-1 pl-0 theme-font-color font-size-name" [ngClass]="{'input-border-bottom':editHR}">
            <div class="members-dropup position-absolute" #managerScrollContainer *ngIf="managerDropupOpen && editHR"
              click-outside (clickOutside)="managerDropupClickOutside($event)">
              <div class="member-card p-2 cursor-hand d-flex flex-column" *ngFor="let user of all_members_search_results;
                       let i = index" [ngClass]="{'active': active_index == i}" [id]="'manager-card' + i"
                (click)="onManagerSelected(user)">
                <span class="overflow-ellipsis">{{user.full_name}}</span>
                <span class="overflow-ellipsis small text-muted">{{user.email || user.contact_number}}</span>
              </div>
            </div>
            <input type="text" class="border-none outline-none manager-input p-1 w-100 theme-font-color input-bg"
              (focus)="getAllMembers()" (keydown)="onManagerBoxKeyDownEvent($event)"
              [ngClass]="{'form-read-only': !editHR}" [readonly]="!editHR" [formControl]="managerSearchCtrl">
          </div>
        </div>
      </div>
    </form>
  </div>
</div>

<app-message-modal *ngIf="showDeleteConfirmationPopup" [@messageModalAnimation]
  (closeMessageModal)="showDeleteConfirmationPopup = false">
  <p class="message-modal-description">Are you sure you want to delete the profile picture?</p>
  <div class="d-flex justify-content-end">
    <button class="message-modal-button mr-3 message-modal-button-red btn-red outline-none" type="button"
      (click)="showDeleteConfirmationPopup = false">No</button>
    <button class="message-modal-button outline-none" (click)="removeUserProfilePhoto()" type="button">Yes</button>
  </div>
</app-message-modal>

<app-message-modal *ngIf="phoneChangePopup" [width]="'30%'" [@messageModalAnimation]
  (closeMessageModal)="phoneChangePopup = false">
  <div class="d-flex justify-content-between">
    <div class="message-modal-heading">
      {{profileInfo && profileInfo.contact_number ? 'Change phone number' : 'Add phone number'}}
    </div>
    <span (click)="phoneChangePopup = false" class="cursor-hand">
      <svg class="cursor-hand close-icon-phone-popup" id="Layer_1" xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24" width="21" height="21">
        <path opacity=".45" fill="var(--chat-header-text)"
          d="M19.1 17.2l-5.3-5.3 5.3-5.3-1.8-1.8-5.3 5.4-5.3-5.3-1.8 1.7 5.3 5.3-5.3 5.3L6.7 19l5.3-5.3 5.3 5.3 1.8-1.8z">
        </path>
      </svg>
    </span>
  </div>
  <div>
    <form [formGroup]="otpRequestForm" role="form" (submit)="requestOtp()">
      <div class="form-group position-relative">
        <app-intl-phone-input [hidden]="otp_requested" class="phone-dropdown-container position-absolute"
          [(phoneObj)]="selected_country_code"></app-intl-phone-input>
        <b [hidden]="!otp_requested" class="phone-hidden-container country-code-position position-absolute">
          {{'+' + selected_country_code.dialCode}}</b>
        <input type="tel" (keypress)="allowNumberInput($event)" appAutofocus
          [ngStyle]="{'padding-left' : (selected_country_code.dialCode.toString().length  * 9) + 40 + 'px' }"
          [readonly]="otp_requested" placeholder="Enter your new phone number"
          class="form-control form-signup-custom color-bg" formControlName="phone" id="inputPhone">
      </div>
      <div class="d-flex justify-content-center">
        <button class="btn btn-next" [disabled]="!otpRequestForm.valid">{{!otp_requested ? 'Request OTP' : 'Resend OTP'}}</button>
      </div>
    </form>
    <form class="mt-2 d-flex justify-content-center flex-column align-items-center" role="form" [formGroup]="otpForm"
      (submit)="submitOtp()" *ngIf="otp_requested">
      <label class="form-custom-label">
        Confirmation Code
      </label>
      <div class="d-flex otp-wrapper align-items-center">
        <input type="tel" appAutofocus maxlength="1" tabindex="1" #otp1 (paste)="onOTPpaste($event,otp6)"
          (keyup)="nextFocus($event,otp2,otp1)" class="otp-box otp-box-1" formControlName="otp_1" data-key="otp1">
        <input type="tel" maxlength="1" tabindex="2" #otp2 (keyup)="nextFocus($event,otp3,otp1)" class="otp-box"
          formControlName="otp_2" data-key="otp2">
        <input type="tel" maxlength="1" tabindex="3" #otp3 (keyup)="nextFocus($event,otp4,otp2)"
          class="otp-box otp-box-3" formControlName="otp_3" data-key="otp3">
        <div class="pl-2 pr-2 hyphen">
          &mdash;
        </div>
        <input type="tel" maxlength="1" tabindex="4" #otp4 (keyup)="nextFocus($event,otp5,otp3)"
          class="otp-box otp-box-1" formControlName="otp_4" data-key="otp4">
        <input type="tel" maxlength="1" tabindex="5" #otp5 (keyup)="nextFocus($event,otp6,otp4)" class="otp-box"
          formControlName="otp_5" data-key="otp5">
        <input type="tel" maxlength="1" tabindex="6" #otp6 (keyup)="nextFocus($event,otp6,otp5)"
          class="otp-box otp-box-3" formControlName="otp_6" data-key="otp6">
      </div>
      <div class="mt-4">
        <button class="btn btn-next btn-40 pl-3 pr-3" [disabled]="!otpForm.valid">Continue
          <img src="/assets/img/arrow-right.svg" class="pl-2">
        </button>
      </div>
    </form>
  </div>
</app-message-modal>
<!-- animation for profile image[@parentAnimate] -->
<div *ngIf="view_profile_enlarged">
  <div (click)="view_profile_enlarged = false"
    class="enlarged-background back-image d-flex justify-content-center align-items-center">
    <img
      [@imageZoom]="{value: undefined, params: { imageStartHeight: '200px', imageStartWidth: '200px', animationHeightX: animationHeightX, animationHeightY: animationHeightY}}"
      class="animate-container-position image-size-animate user-select-none"
      [src]="profileInfo.user_image || profileInfo.user_image_url">
  </div>
</div>
<app-image-cropper *ngIf="showCroppingPopup" [cropObj]="cropObj" (sendCroppedImage)="saveCroppedImage($event)"
  (closeCropPopup)="closeCropPopupFunc()"></app-image-cropper>
