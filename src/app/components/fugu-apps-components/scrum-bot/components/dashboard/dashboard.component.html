<div class="d-flex flex-column w-100 h-100 overflow-hidden p-3 bg-white round-border font-proxima">
  <!-- <div class="d-flex">
    <h2>Fugu Team Test</h2>
  </div> -->
  <div class="d-flex justify-content-between align-items-center mt-4">
    <h3>Reports</h3>
    <button class="btn btn-primary" (click)="createNew()">Create Report</button>
  </div>
  <div class="mt-4 overflow-auto h-100">
    <div *ngIf="reports?.length">
      <div class="bordered shadowed-box round-border mb-3" *ngFor="let report of reports;let i = index"
        [id]="'report' + i">
        <!-- <div class="card border-0"> -->
          <div class="card-header bg-white border-bottom-0 pl-2 pr-2">
            <h2 class="mb-0">
              <button class="btn box-shadow-none w-100" type="button">
                <div class="d-flex justify-content-between align-items-center">
                  <div class="text-truncate w-100 text-left" (click)="report.active = !report.active" data-toggle="collapse"
                    [attr.data-target]="'#report-' + report.scrum_id">
                    <span class="report-name mr-3">{{report.scrum_name}}</span>
                    <span class="report-desc outline-none border-none" [routerLink]="['../../scrum-bot/report', 1]" [queryParams]="{edit: true , id: report.scrum_id}">
                      <span *ngFor="let day of report.active_days">
                        {{weekdays[day].name}}
                    </span> at {{report.start_time | UTCLocal: report.time_zone}} ({{recurringTime[(report.frequency)].name}})</span>
                    <span class="ml-2 p-1 label-orange" *ngIf="report.scrum_status == 'PAUSED'"> Paused</span>
                  </div>
                  <div class="d-flex" click-outside (clickOutside)="onEditClickOutside($event, report)">
                    <img *ngIf="report.manager_user_id.user_id == userData.user_id" class="h-22px cursor-hand mr-2" src="/assets/img/settings.svg" alt="settings"
                      (click)="openReportMenu($event, report)">
                    <i (click)="report.active = !report.active" class="fas fa-chevron-down link img-arrow" [ngClass]="{'active': report.active}" data-toggle="collapse"
                      [attr.data-target]="'#report-' + report.scrum_id"></i>
                  </div>
                </div>
              </button>
            </h2>
          </div>
          <div [id]="'report-' + report.scrum_id" class="collapse" [attr.data-parent]="'#' + 'report' + i">
            <div class="card-body d-flex pt-0">
              <div class="w-50 d-flex">
                <img class="h-22px mt-1 mr-2" src="/assets/img/user.svg">
                <div class="d-flex flex-column">
                  <div class="report-desc cursor-hand outline-none" [routerLink]="['../../scrum-bot/report', 2]"
                    [queryParams]="{edit: true , id: report.scrum_id}">Respondents
                  </div>
                  <div class="text-muted">
                    {{report.respondants?.length ? report.respondants.length : '0'}} people,
                    {{report.questions?.length ? report.questions.length : '0'}} questions,
                    {{waitingTime[report.scrum_time].name}} waiting time
                  </div>
                </div>
              </div>
              <div class="w-50 d-flex border-left pl-3">
                <img class="h-22px mt-1 mr-2" src="/assets/img/notebook.svg">
                <div class="d-flex flex-column">
                  <div class="report-desc cursor-hand outline-none" [routerLink]="['../../scrum-bot/report', 3]"
                    [queryParams]="{edit: true, id: report.scrum_id}">Results</div>
                  <!-- <span class="link cursor-hand outline-none" [routerLink]="['../../scrum-bot/history']">View History</span> -->
                  <div class="text-muted">
                    {{report.delivering_result_to_users.length}} people, {{report.delivering_result_to_channels.length}}
                    {{report.delivering_result_to_channels.length > 1 ? 'channels' : 'channel'}}
                  </div>
                </div>
              </div>
              <div class="w-50 d-flex border-left pl-3">
                <img class="h-22px mt-1 mr-2" src="/assets/img/idea.svg">
                <div class="d-flex flex-column">
                  <div class="report-desc cursor-hand outline-none">Created By</div>
                  <div class="text-muted">
                    <span>{{report.manager_user_id.full_name}} </span>
                    <span>({{report.manager_user_id.email}})</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div *ngIf="report.reportMenuActive" class="position-absolute options-mask w-100 h-100"
            (click)="report.reportMenuActive = false">
            <div class="reports-options-menu position-absolute bordered shadowed-box round-border" id="report-menu">
              <button class="btn-custom-nostyle outline-none box-shadow-none w-100 p-2 pl-3 pr-3 cursor-hand"
                [routerLink]="['../../scrum-bot/report', 1]" [queryParams]="{edit: true, id: report.scrum_id}">
                Edit Report
              </button>
              <button *ngIf="report.scrum_status == 'PAUSED'"
                class="btn-custom-nostyle outline-none box-shadow-none w-100 p-2 pl-3 pr-3 cursor-hand"
                (click)="activateReport(report, 'ACTIVE')">
                Activate Report
              </button>
              <button *ngIf="report.scrum_status == 'ACTIVE' || report.scrum_status == 'RUNNING'"
                class="btn-custom-nostyle outline-none box-shadow-none w-100 p-2 pl-3 pr-3 cursor-hand"
                (click)="activateReport(report, 'PAUSED')">
                Pause Report
              </button>
              <button class="btn-custom-nostyle outline-none box-shadow-none w-100 p-2 pl-3 pr-3 cursor-hand" (click)="runScrumNow(report)">
                Run now
              </button>
              <button (click)="report.deleteScrumReport = true"
                class="btn-custom-nostyle outline-none box-shadow-none w-100 p-2 pl-3 pr-3 cursor-hand">
                Delete
              </button>
            </div>
          </div>
          <app-message-modal *ngIf="report.deleteScrumReport" [width]="'30%'" [@messageModalAnimation]
            (closeMessageModal)="report.deleteScrumReport = false">
            <p class="message-modal-description">Are you sure you want to delete this scrum report?</p>
            <div class="d-flex justify-content-end">
              <button class="message-modal-button message-modal-button-red btn-red outline-none mr-3" type="button"
                (click)="report.deleteScrumReport = false">No</button>
              <button class="message-modal-button outline-none" type="button" (click)= "deleteScrum(report)">Yes</button>
            </div>
          </app-message-modal>
        <!-- </div> -->
      </div>
    </div>
    <div *ngIf="!reports?.length" class="h-100 d-flex align-items-center justify-content-center">
       No scrum reports to show
    </div>
  </div>
</div>
